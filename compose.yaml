services:
  voice-stack:
    image: voice-stack:latest
    container_name: voice-stack
    build:
      context: .

    # Run container as root (needed for system JACK access)
    user: root

    # Grant real-time scheduling capability for JACK
    cap_add:
      - SYS_NICE      # Real-time priority
      - IPC_LOCK      # Lock memory for JACK
    ulimits:
      memlock:
        soft: -1
        hard: -1

    # use host network to share MAC address with host
    network_mode: host
    # ipc: host

    # Interactive mode for debugging and management
    stdin_open: true
    tty: true

    # Volumes
    volumes:
      # Required: JACK uses shared memory
      - /dev/shm:/dev/shm
      # Audio assets (read-only)
      - ./assets/audio:/app/assets/audio:ro
      # Config files (read-only)
      - ./config:/app/config:ro

    # Writable tmpfs for VTN runtime
    tmpfs:
      - /app/bin:mode=0755

    # Environment file
    env_file:
      - .env

    # Expose service ports
    ports:
      - "53101:53101"   # ASRD TCP
      - "55303:55303"   # PLAYCTL HTTP

    # Restart policy
    restart: unless-stopped
